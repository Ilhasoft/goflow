<html>
    <head>
        <title>Context</title>
        <link href="https://fonts.googleapis.com/css?family=Roboto+Slab" rel="stylesheet">
        <link href="styles.css" rel="stylesheet">
    </head>
    <body>
        <center>
            <h7>Context</h7>
        </center>

 <ul>
 <li><a href="#context">Context</a></li>
 </ul>  

<h1 id="context">Context</h1>
<p>The context is all the variables which are accessible in expressions and contains the following top-level variables:</p>
<ul>
<li><code>run</code> the current <a href="#context:run">run</a></li>
<li><code>parent</code> the parent of the current <a href="#context:run">run</a>, i.e. the run that started the current run</li>
<li><code>child</code> the child of the current <a href="#context:run">run</a>, i.e. the last subflow</li>
<li><code>contact</code> the current <a href="#context:contact">contact</a>, shortcut for <code>@run.contact</code></li>
<li><code>results</code> the current <a href="#context:result">results</a>, shortcut for <code>@run.results</code></li>
<li><code>trigger</code> the <a href="#context:trigger">trigger</a> that initiated this session</li>
<li><code>input</code> the last <a href="#context:input">input</a> from the contact</li>
</ul>
<p>The following types appear in the context:</p>
<ul>
<li><a href="#context:channel">Channel</a></li>
<li><a href="#context:contact">Contact</a></li>
<li><a href="#context:flow">Flow</a></li>
<li><a href="#context:group">Group</a></li>
<li><a href="#context:input">Input</a></li>
<li><a href="#context:result">Result</a></li>
<li><a href="#context:run">Run</a></li>
<li><a href="#context:trigger">Trigger</a></li>
<li><a href="#context:urn">URN</a></li>
</ul>
<div class="context">
<p><a name="context:channel"></a></p>
<h2 id="channel">Channel</h2>
<p>Represents a means for sending and receiving input during a flow run. It renders as its name in a template, and has the following properties which can be accessed:</p>
<ul>
<li><code>uuid</code> the UUID of the channel</li>
<li><code>name</code> the name of the channel</li>
<li><code>address</code> the address of the channel</li>
</ul>
<p>Examples:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode objectivec"><code class="sourceCode objectivec"><span id="cb1-1"><a href="#cb1-1"></a>@contact.channel → My Android Phone</span>
<span id="cb1-2"><a href="#cb1-2"></a>@contact.channel.name → My Android Phone</span>
<span id="cb1-3"><a href="#cb1-3"></a>@contact.channel.address → +<span class="dv">12345671111</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>@input.channel.uuid → 57f1078f-88aa-46f4-a59a-948a5739c03d</span>
<span id="cb1-5"><a href="#cb1-5"></a>@(json(contact.channel)) → {<span class="st">&quot;address&quot;</span>:<span class="st">&quot;+12345671111&quot;</span>,<span class="st">&quot;name&quot;</span>:<span class="st">&quot;My Android Phone&quot;</span>,<span class="st">&quot;uuid&quot;</span>:<span class="st">&quot;57f1078f-88aa-46f4-a59a-948a5739c03d&quot;</span>}</span></code></pre></div>
<p><a name="context:contact"></a></p>
<h2 id="contact">Contact</h2>
<p>Represents a person who is interacting with the flow. It renders as the person’s name (or perferred URN if name isn’t set) in a template, and has the following properties which can be accessed:</p>
<ul>
<li><code>uuid</code> the UUID of the contact</li>
<li><code>name</code> the full name of the contact</li>
<li><code>first_name</code> the first name of the contact</li>
<li><code>language</code> the <a href="http://www-01.sil.org/iso639-3/">ISO-639-3</a> language code of the contact</li>
<li><code>timezone</code> the timezone name of the contact</li>
<li><code>created_on</code> the datetime when the contact was created</li>
<li><code>urns</code> all <a href="#context:urn">URNs</a> the contact has set</li>
<li><code>urns.[scheme]</code> all the <a href="#context:urn">URNs</a> the contact has set for the particular URN scheme</li>
<li><code>urn</code> shorthand for <code>@(format_urn(c.urns.0))</code>, i.e. the contact’s preferred <a href="#context:urn">URN</a> in friendly formatting</li>
<li><code>groups</code> all the <a href="#context:group">groups</a> that the contact belongs to</li>
<li><code>fields</code> all the custom contact fields the contact has set</li>
<li><code>fields.[snaked_field_name]</code> the value of the specific field</li>
<li><code>channel</code> shorthand for <code>contact.urns[0].channel</code>, i.e. the <a href="#context:channel">channel</a> of the contact’s preferred URN</li>
</ul>
<p>Examples:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode objectivec"><code class="sourceCode objectivec"><span id="cb2-1"><a href="#cb2-1"></a>@contact.name → Ryan Lewis</span>
<span id="cb2-2"><a href="#cb2-2"></a>@contact.first_name → Ryan</span>
<span id="cb2-3"><a href="#cb2-3"></a>@contact.language → eng</span>
<span id="cb2-4"><a href="#cb2-4"></a>@contact.timezone → America/Guayaquil</span>
<span id="cb2-5"><a href="#cb2-5"></a>@contact.created_on → <span class="dv">2018-06</span>-20T11:<span class="dv">40</span>:<span class="fl">30.123456</span>Z</span>
<span id="cb2-6"><a href="#cb2-6"></a>@contact.urns → [tel:+<span class="dv">12065551212</span>, twitterid:<span class="dv">54784326227</span>#nyaruka, mailto:foo@bar.com]</span>
<span id="cb2-7"><a href="#cb2-7"></a>@(contact.urns[<span class="dv">0</span>]) → tel:+<span class="dv">12065551212</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>@contact.urn → tel:+<span class="dv">12065551212</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>@(foreach(contact.groups, extract, <span class="st">&quot;name&quot;</span>)) → [Testers, Males]</span>
<span id="cb2-10"><a href="#cb2-10"></a>@contact.fields → Activation Token: AACC55\nAge: <span class="dv">23</span>\nGender: Male\nJoin Date: <span class="dv">2017-12</span>-02T00:<span class="dv">00</span>:<span class="fl">00.000000</span><span class="dv">-02</span>:<span class="dv">00</span></span>
<span id="cb2-11"><a href="#cb2-11"></a>@contact.fields.activation_token → AACC55</span>
<span id="cb2-12"><a href="#cb2-12"></a>@contact.fields.gender → Male</span></code></pre></div>
<p><a name="context:flow"></a></p>
<h2 id="flow">Flow</h2>
<p>Describes the ordered logic of actions and routers. It renders as its name in a template, and has the following properties which can be accessed:</p>
<ul>
<li><code>uuid</code> the UUID of the flow</li>
<li><code>name</code> the name of the flow</li>
<li><code>revision</code> the revision number of the flow</li>
</ul>
<p>Examples:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode objectivec"><code class="sourceCode objectivec"><span id="cb3-1"><a href="#cb3-1"></a>@run.flow → Registration</span>
<span id="cb3-2"><a href="#cb3-2"></a>@child.flow.name → Collect Age</span>
<span id="cb3-3"><a href="#cb3-3"></a>@run.flow.uuid → 50c3706e-fedb-42c0-8eab-dda3335714b7</span>
<span id="cb3-4"><a href="#cb3-4"></a>@(json(run.flow)) → {<span class="st">&quot;name&quot;</span>:<span class="st">&quot;Registration&quot;</span>,<span class="st">&quot;revision&quot;</span>:<span class="dv">123</span>,<span class="st">&quot;uuid&quot;</span>:<span class="st">&quot;50c3706e-fedb-42c0-8eab-dda3335714b7&quot;</span>}</span></code></pre></div>
<p><a name="context:group"></a></p>
<h2 id="group">Group</h2>
<p>Represents a grouping of contacts. It can be static (contacts are added and removed manually through <a href="#action:add_contact_groups">actions</a>) or dynamic (contacts are added automatically by a query). It renders as its name in a template, and has the following properties which can be accessed:</p>
<ul>
<li><code>uuid</code> the UUID of the group</li>
<li><code>name</code> the name of the group</li>
</ul>
<p>Examples:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode objectivec"><code class="sourceCode objectivec"><span id="cb4-1"><a href="#cb4-1"></a>@(foreach(contact.groups, extract, <span class="st">&quot;name&quot;</span>)) → [Testers, Males]</span>
<span id="cb4-2"><a href="#cb4-2"></a>@(contact.groups[<span class="dv">0</span>].uuid) → b7cf0d83-f1c9-411c-96fd-c511a4cfa86d</span>
<span id="cb4-3"><a href="#cb4-3"></a>@(contact.groups[<span class="dv">1</span>].name) → Males</span>
<span id="cb4-4"><a href="#cb4-4"></a>@(json(contact.groups[<span class="dv">1</span>])) → {<span class="st">&quot;name&quot;</span>:<span class="st">&quot;Males&quot;</span>,<span class="st">&quot;uuid&quot;</span>:<span class="st">&quot;4f1f98fc-27a7-4a69-bbdb-24744ba739a9&quot;</span>}</span></code></pre></div>
<p><a name="context:input"></a></p>
<h2 id="input">Input</h2>
<p>Describes input from the contact and currently we only support one type of input: <code>msg</code>. Any input has the following properties which can be accessed:</p>
<ul>
<li><code>uuid</code> the UUID of the input</li>
<li><code>type</code> the type of the input, e.g. <code>msg</code></li>
<li><code>channel</code> the <a href="#context:channel">channel</a> that the input was received on</li>
<li><code>created_on</code> the time when the input was created</li>
</ul>
<p>An input of type <code>msg</code> renders as its text and attachments in a template, and has the following additional properties:</p>
<ul>
<li><code>text</code> the text of the message</li>
<li><code>attachments</code> any <a href="#context:attachment">attachments</a> on the message</li>
<li><code>urn</code> the <a href="#context:urn">URN</a> that the input was received on</li>
</ul>
<p>Examples:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode objectivec"><code class="sourceCode objectivec"><span id="cb5-1"><a href="#cb5-1"></a>@input → Hi there\nhttp:<span class="co">//s3.amazon.com/bucket/test.jpg\nhttp://s3.amazon.com/bucket/test.mp3</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>@input.type → msg</span>
<span id="cb5-3"><a href="#cb5-3"></a>@input.text → Hi there</span>
<span id="cb5-4"><a href="#cb5-4"></a>@input.attachments → [image/jpeg:http:<span class="co">//s3.amazon.com/bucket/test.jpg, audio/mp3:http://s3.amazon.com/bucket/test.mp3]</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>@(json(input)) → {<span class="st">&quot;attachments&quot;</span>:[<span class="st">&quot;image/jpeg:http://s3.amazon.com/bucket/test.jpg&quot;</span>,<span class="st">&quot;audio/mp3:http://s3.amazon.com/bucket/test.mp3&quot;</span>],<span class="st">&quot;channel&quot;</span>:{<span class="st">&quot;address&quot;</span>:<span class="st">&quot;+12345671111&quot;</span>,<span class="st">&quot;name&quot;</span>:<span class="st">&quot;My Android Phone&quot;</span>,<span class="st">&quot;uuid&quot;</span>:<span class="st">&quot;57f1078f-88aa-46f4-a59a-948a5739c03d&quot;</span>},<span class="st">&quot;created_on&quot;</span>:<span class="st">&quot;2017-12-31T11:35:10.035757-02:00&quot;</span>,<span class="st">&quot;external_id&quot;</span>:<span class="st">&quot;&quot;</span>,<span class="st">&quot;text&quot;</span>:<span class="st">&quot;Hi there&quot;</span>,<span class="st">&quot;type&quot;</span>:<span class="st">&quot;msg&quot;</span>,<span class="st">&quot;urn&quot;</span>:<span class="st">&quot;tel:+12065551212&quot;</span>,<span class="st">&quot;uuid&quot;</span>:<span class="st">&quot;9bf91c2b-ce58-4cef-aacc-281e03f69ab5&quot;</span>}</span></code></pre></div>
<p><a name="context:result"></a></p>
<h2 id="result">Result</h2>
<p>Describes a value captured during a run’s execution. It might have been implicitly created by a router, or explicitly created by a <a href="#action:set_run_result">set_run_result</a> action. It renders as its value in a template, and has the following properties which can be accessed:</p>
<ul>
<li><code>value</code> the value of the result</li>
<li><code>category</code> the category of the result</li>
<li><code>category_localized</code> the localized category of the result</li>
<li><code>input</code> the input associated with the result</li>
<li><code>node_uuid</code> the UUID of the node where the result was created</li>
<li><code>extra</code> any additional data associated with this result</li>
<li><code>created_on</code> the time when the result was created</li>
</ul>
<p>Examples:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode objectivec"><code class="sourceCode objectivec"><span id="cb6-1"><a href="#cb6-1"></a>@results → 2Factor: <span class="dv">34634624463525</span>\nFavorite Color: red\nPhone Number: +<span class="dv">12344563452</span>\nwebhook: <span class="dv">200</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>@results.favorite_color → red</span>
<span id="cb6-3"><a href="#cb6-3"></a>@results.favorite_color.value → red</span>
<span id="cb6-4"><a href="#cb6-4"></a>@results.favorite_color.category → Red</span></code></pre></div>
<p><a name="context:run"></a></p>
<h2 id="run">Run</h2>
<p>Is a single contact’s journey through a flow. It records the path they have taken, and the results that have been collected. It has several properties which can be accessed in expressions:</p>
<ul>
<li><code>uuid</code> the UUID of the run</li>
<li><code>flow</code> the <a href="#context:flow">flow</a> of the run</li>
<li><code>contact</code> the <a href="#context:contact">contact</a> of the flow run</li>
<li><code>input</code> the <a href="#context:input">input</a> of the current run</li>
<li><code>results</code> the results that have been saved for this run</li>
<li><code>results.[snaked_result_name]</code> the value of the specific result, e.g. <code>results.age</code></li>
</ul>
<p>Examples:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode objectivec"><code class="sourceCode objectivec"><span id="cb7-1"><a href="#cb7-1"></a>@run → Ryan Lewis@Registration</span>
<span id="cb7-2"><a href="#cb7-2"></a>@run.contact.name → Ryan Lewis</span>
<span id="cb7-3"><a href="#cb7-3"></a>@run.flow.name → Registration</span></code></pre></div>
<p><a name="context:trigger"></a></p>
<h2 id="trigger">Trigger</h2>
<p>Represents something which can initiate a session with the flow engine. It has several properties which can be accessed in expressions:</p>
<ul>
<li><code>type</code> the type of the trigger, one of “manual” or “flow”</li>
<li><code>params</code> the parameters passed to the trigger</li>
</ul>
<p>Examples:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode objectivec"><code class="sourceCode objectivec"><span id="cb8-1"><a href="#cb8-1"></a>@trigger.type → flow_action</span>
<span id="cb8-2"><a href="#cb8-2"></a>@trigger.params → {address: {state: WA}, source: website}</span>
<span id="cb8-3"><a href="#cb8-3"></a>@(json(trigger)) → {<span class="st">&quot;params&quot;</span>:{<span class="st">&quot;address&quot;</span>:{<span class="st">&quot;state&quot;</span>:<span class="st">&quot;WA&quot;</span>},<span class="st">&quot;source&quot;</span>:<span class="st">&quot;website&quot;</span>},<span class="st">&quot;type&quot;</span>:<span class="st">&quot;flow_action&quot;</span>}</span></code></pre></div>
<p><a name="context:urn"></a></p>
<h2 id="urn">Urn</h2>
<p>Represents a destination for an outgoing message or a source of an incoming message. It is string composed of 3 components: scheme, path, and display (optional). For example:</p>
<ul>
<li><em>tel:+16303524567</em></li>
<li><em>twitterid:54784326227#nyaruka</em></li>
<li><em>telegram:34642632786#bobby</em></li>
</ul>
<p>To render a URN in a human friendly format, use the <a href="expressions.html#function:format_urn">format_urn</a> function.</p>
<p>Examples:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode objectivec"><code class="sourceCode objectivec"><span id="cb9-1"><a href="#cb9-1"></a>@(urns.tel) → tel:+<span class="dv">12065551212</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>@(urn_parts(urns.tel).scheme) → tel</span>
<span id="cb9-3"><a href="#cb9-3"></a>@(format_urn(urns.tel)) → (<span class="dv">206</span>) <span class="dv">555-1212</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>@(json(contact.urns[<span class="dv">0</span>])) → <span class="st">&quot;tel:+12065551212&quot;</span></span></code></pre></div>
</div>

    </body>
</html>