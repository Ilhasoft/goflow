[
    {
        "description": "Validation fails if GET has a body",
        "action": {
            "type": "call_webhook",
            "uuid": "ad154980-7bf7-4ab8-8728-545fd6378912",
            "method": "GET",
            "url": "http://localhost:49996/?cmd=success",
            "body": "Hi there!"
        },
        "validation_error": "can't specify body if method is GET"
    },
    {
        "description": "Validation fails if header name is invalid",
        "action": {
            "type": "call_webhook",
            "uuid": "ad154980-7bf7-4ab8-8728-545fd6378912",
            "method": "POST",
            "url": "http://localhost:49996/?cmd=success",
            "body": "Hi there!",
            "headers": {
                "Accept:": "something"
            }
        },
        "validation_error": "header 'Accept:' is not a valid HTTP header"
    },
    {
        "description": "Error event created if URL, header or body contain expression errors",
        "action": {
            "type": "call_webhook",
            "uuid": "ad154980-7bf7-4ab8-8728-545fd6378912",
            "method": "POST",
            "url": "http://localhost:49996/?cmd=success@(1 / 0)",
            "headers": {
                "Authentication": "Token @(2 / 0)-@fields.age"
            },
            "body": "@(3 / 0)"
        },
        "events": [
            {
                "created_on": "2018-10-18T14:20:30.000123456Z",
                "fatal": false,
                "step_uuid": "e7187099-7d38-4f60-955c-325957214c42",
                "text": "error evaluating @(1 / 0): division by zero",
                "type": "error"
            },
            {
                "created_on": "2018-10-18T14:20:30.000123456Z",
                "fatal": false,
                "step_uuid": "e7187099-7d38-4f60-955c-325957214c42",
                "text": "error evaluating @(3 / 0): division by zero",
                "type": "error"
            },
            {
                "created_on": "2018-10-18T14:20:30.000123456Z",
                "fatal": false,
                "step_uuid": "e7187099-7d38-4f60-955c-325957214c42",
                "text": "error evaluating @(2 / 0): division by zero",
                "type": "error"
            },
            {
                "created_on": "2018-10-18T14:20:30.000123456Z",
                "elapsed_ms": 0,
                "request": "POST /?cmd=success HTTP/1.1\r\nHost: localhost:49996\r\nUser-Agent: goflow-testing\r\nContent-Length: 0\r\nAuthentication: Token -\r\nAccept-Encoding: gzip\r\n\r\n",
                "response": "HTTP/1.1 200 OK\r\nContent-Length: 16\r\nContent-Type: text/plain; charset=utf-8\r\nDate: Wed, 11 Apr 2018 18:24:30 GMT\r\n\r\n{ \"ok\": \"true\" }",
                "status": "success",
                "status_code": 200,
                "step_uuid": "e7187099-7d38-4f60-955c-325957214c42",
                "type": "webhook_called",
                "url": "http://localhost:49996/?cmd=success"
            }
        ],
        "inspection": {
            "templates": [
                "http://localhost:49996/?cmd=success@(1 / 0)",
                "@(3 / 0)",
                "Token @(2 / 0)-@fields.age"
            ],
            "dependencies": [
                "field[key=age,name=]"
            ],
            "results": []
        }
    },
    {
        "description": "Error event created and action skipped if URL evaluates to empty",
        "action": {
            "type": "call_webhook",
            "uuid": "ad154980-7bf7-4ab8-8728-545fd6378912",
            "method": "GET",
            "url": "@(\"\")"
        },
        "events": [
            {
                "created_on": "2018-10-18T14:20:30.000123456Z",
                "fatal": false,
                "step_uuid": "e7187099-7d38-4f60-955c-325957214c42",
                "text": "call_webhook URL evaluated to empty string, skipping",
                "type": "error"
            }
        ],
        "inspection": {
            "templates": [
                "@(\"\")"
            ],
            "dependencies": [],
            "results": []
        }
    },
    {
        "description": "Result changed event created if result name set",
        "action": {
            "type": "call_webhook",
            "uuid": "ad154980-7bf7-4ab8-8728-545fd6378912",
            "method": "POST",
            "url": "http://localhost:49996/?cmd=success",
            "body": "Hi there!",
            "headers": {
                "X-Something": "@fields.gender"
            },
            "result_name": "My Webhook"
        },
        "events": [
            {
                "created_on": "2018-10-18T14:20:30.000123456Z",
                "elapsed_ms": 0,
                "request": "POST /?cmd=success HTTP/1.1\r\nHost: localhost:49996\r\nUser-Agent: goflow-testing\r\nContent-Length: 9\r\nX-Something: Male\r\nAccept-Encoding: gzip\r\n\r\nHi there!",
                "response": "HTTP/1.1 200 OK\r\nContent-Length: 16\r\nContent-Type: text/plain; charset=utf-8\r\nDate: Wed, 11 Apr 2018 18:24:30 GMT\r\n\r\n{ \"ok\": \"true\" }",
                "status": "success",
                "status_code": 200,
                "step_uuid": "e7187099-7d38-4f60-955c-325957214c42",
                "type": "webhook_called",
                "url": "http://localhost:49996/?cmd=success"
            },
            {
                "category": "Success",
                "created_on": "2018-10-18T14:20:30.000123456Z",
                "extra": {
                    "ok": "true"
                },
                "input": "POST http://localhost:49996/?cmd=success",
                "name": "My Webhook",
                "step_uuid": "e7187099-7d38-4f60-955c-325957214c42",
                "type": "run_result_changed",
                "value": "200"
            }
        ],
        "inspection": {
            "templates": [
                "http://localhost:49996/?cmd=success",
                "Hi there!",
                "@fields.gender"
            ],
            "dependencies": [
                "field[key=gender,name=]"
            ],
            "results": [
                {
                    "key": "my_webhook",
                    "name": "My Webhook",
                    "categories": [
                        "Success",
                        "Failure"
                    ]
                }
            ]
        }
    }
]